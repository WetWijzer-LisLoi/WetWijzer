// Accessibility Utilities
// ===================================
// These styles enhance accessibility and should be kept as they provide
// important functionality that isn't fully covered by Tailwind's utilities

// Screen reader only - hides elements visually but keeps them accessible to screen readers
.sr-only {
  @apply absolute w-px h-px p-0 -m-px overflow-hidden whitespace-nowrap border-0;
  clip: rect(0, 0, 0, 0);
  
  &-focusable {
    &:active,
    &:focus {
      @apply static w-auto h-auto overflow-visible whitespace-normal;
      clip: auto;
    }
  }
}

// Skip to main content link
.skip-to-content {
  @apply absolute z-50 p-3 m-3 -translate-y-16 text-white bg-blue-600 rounded-md transition-transform duration-200 ease-in-out focus:translate-y-0;
  
  &:focus {
    @apply outline-none ring-2 ring-offset-2 ring-blue-500;
  }
}

// High contrast mode
// This is important for Windows High Contrast Mode users
@media (forced-colors: active) {
  // Add visible borders to interactive elements
  button,
  [role="button"],
  [type="button"],
  [type="reset"],
  [type="submit"],
  a,
  input,
  select,
  textarea,
  [tabindex]:not([tabindex="-1"]) {
    outline: 2px solid transparent;
    outline-offset: 2px;
  }
  
  // Ensure text has sufficient contrast
  body {
    forced-color-adjust: none;
  }
}

// Reduce motion
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

// Dark mode toggle focus styles
.dark-mode-toggle {
  @apply focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-blue-500 rounded-full;
}

// Form field focus states
input[type="text"],
input[type="email"],
input[type="password"],
input[type="number"],
input[type="tel"],
input[type="url"],
input[type="search"],
input[type="date"],
input[type="datetime-local"],
input[type="month"],
input[type="time"],
input[type="week"],
select,
textarea {
  @apply focus:ring-2 focus:ring-blue-500 focus:border-blue-500;
  
  .dark & {
    @apply focus:ring-blue-400 focus:border-blue-400;
  }
}

// Focus styles for buttons and links
button,
[role="button"],
a[role="button"] {
  @apply focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-blue-500;
  
  &:disabled {
    @apply focus-visible:ring-0;
  }
}

// Skip link focus styles
.skip-link {
  @apply sr-only focus:not-sr-only focus:fixed focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-white focus:text-blue-600 focus:rounded focus:shadow-lg;
}

// Visually hidden but focusable
.visually-hidden {
  @apply sr-only;
  
  &:focus,
  &:active {
    @apply not-sr-only static w-auto h-auto overflow-visible whitespace-normal;
    clip: auto;
  }
}

// Focus indicator for keyboard navigation only
// This will only show the focus ring when navigating with keyboard
.js-focus-visible :focus:not(.focus-visible) {
  outline: none;
}

// Print styles for better accessibility
@media print {
  // Ensure links are visible and include URLs
  a {
    text-decoration: underline !important;
    
    &[href^="http"]:after {
      content: " (" attr(href) ")";
      font-size: 90%;
    }
  }
  
  // Ensure sufficient color contrast
  body {
    color: #000;
    background: #fff;
  }
  
  // Don't print background colors
  * {
    background: transparent !important;
    color: #000 !important;
    box-shadow: none !important;
    text-shadow: none !important;
  }
  
  // Show link destinations in print
  .print-urls a:after {
    content: " (" attr(href) ")";
    font-size: 90%;
  }
  
  // Don't show hidden elements
  .no-print,
  .no-print * {
    display: none !important;
  }
}

// High contrast mode
.high-contrast {
  // Force colors for better visibility
  --bg-color: #ffffff;
  --text-color: #000000;
  --link-color: #0000ff;
  --border-color: #000000;
  
  background-color: var(--bg-color) !important;
  color: var(--text-color) !important;
  
  * {
    background-color: inherit !important;
    color: inherit !important;
    border-color: var(--border-color) !important;
  }
  
  a {
    color: var(--link-color) !important;
    text-decoration: underline !important;
  }
  
  // Ensure focus indicators are highly visible
  :focus {
    outline: 3px solid #ff0000 !important;
    outline-offset: 2px;
  }
  
  // Add borders to interactive elements
  button,
  [role="button"],
  input,
  select,
  textarea {
    border: 2px solid var(--border-color) !important;
    padding: 0.5rem !important;
  }
}

// Reduced motion alternative styles
.reduced-motion {
  // Disable animations and transitions
  *,
  *::before,
  *::after {
    animation: none !important;
    transition: none !important;
    scroll-behavior: auto !important;
  }
  
  // Replace animations with fades where needed
  .fade-in {
    opacity: 1 !important;
  }
  
  // Disable parallax effects
  [data-aos],
  .aos-animate {
    opacity: 1 !important;
    transform: none !important;
  }
}

// Dark mode overrides for accessibility
@media (prefers-color-scheme: dark) {
  // Ensure text has sufficient contrast in dark mode
  body {
    color-scheme: dark;
  }
  
  // Override any problematic dark mode colors
  .text-muted {
    color: #9ca3af !important;
  }
  
  // Ensure form controls are visible
  input,
  select,
  textarea {
    background-color: #1f2937 !important;
    border-color: #4b5563 !important;
    color: #f9fafb !important;
    
    &::placeholder {
      color: #9ca3af !important;
    }
  }
  
  // Ensure disabled states are visible
  :disabled,
  [disabled] {
    opacity: 0.6 !important;
  }
}

// Print link URLs (for better usability when printed)
@media print {
  a[href^="http"]:not([href*="mysite.com"])::after {
    content: " (" attr(href) ")";
    font-size: 80%;
    color: #6b7280;
  }
  
  // Hide print URL for anchor links
  a[href^="#"]::after {
    content: "";
  }
}

// Focus ring for keyboard navigation
:focus-visible {
  outline: 2px solid #3b82f6;
  outline-offset: 2px;
  border-radius: 0.25rem;
}

// Hide content visually but keep it accessible to screen readers
.visually-hidden {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

// Skip navigation link
.skip-nav {
  @apply absolute p-3 -translate-y-16 bg-white border border-gray-300 rounded-md left-4 top-4 focus:translate-y-0 focus:z-50;
  
  &:focus {
    @apply outline-none ring-2 ring-offset-2 ring-blue-500;
  }
}

// ARIA live regions
[aria-live="polite"] {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
  
  &:focus,
  &:active {
    position: static;
    width: auto;
    height: auto;
    overflow: visible;
    clip: auto;
    white-space: normal;
  }
}

// Focus indicators for keyboard users
.js-focus-visible :focus:not(.focus-visible) {
  outline: none;
}

// High contrast focus styles
.high-contrast :focus {
  outline: 3px solid #ff0 !important;
  outline-offset: 2px;
}

// Print styles for better readability
@media print {
  // Ensure sufficient contrast
  * {
    color: #000 !important;
    background: #fff !important;
  }
  
  // Add URLs after links
  a[href^='http']:after {
    content: ' (' attr(href) ')';
    font-size: 0.8em;
  }
  
  // Page breaks
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  
  p, ul, ol, dl, table, img {
    page-break-inside: avoid;
  }
  
  // Don't break important elements
  .no-break {
    page-break-inside: avoid;
  }
}

// Reduced motion media query
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}
