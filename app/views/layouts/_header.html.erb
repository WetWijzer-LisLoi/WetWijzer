<header class="bg-[var(--surface-header-bg)] no-print" data-controller="dark-mode">
  <div class="container mx-auto px-4 py-2">
    <div class="flex justify-between items-center">
      <div class="flex items-center space-x-4 text-sm">
                        <%# This link toggles dark mode. It works via a URL param for non-JS users, 
           but the Stimulus controller will intercept the click for JS users to provide a smooth toggle. %>
        <%= link_to url_for(params.permit!.merge(dark_mode: (params[:dark_mode] == 'dark' ? 'light' : 'dark'))), 
                    data: { action: "click->dark-mode#toggle" }, 
                    class: %w[text-gray-600 dark:text-mist hover:text-[var(--accent-600)] dark:hover:text-[var(--accent-500)] transition-colors duration-150 ease-out motion-reduce:transition-none focus:outline-none].join(" ") do %>
          <svg class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M12 6a6 6 0 100 12 6 6 0 000-12z"></path></svg>
          <svg class="w-5 h-5 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
        <% end %>
        <div class="relative" data-controller="theme-selector">
          <button type="button"
                  class="flex items-center justify-center w-6 h-6 rounded-full text-gray-600 dark:text-mist hover:text-[var(--accent-600)] dark:hover:text-[var(--accent-500)] transition-colors duration-150 ease-out motion-reduce:transition-none"
                  aria-label="<%= t('theme.choose_accent') %>"
                  title="<%= t('theme.choose_accent') %>"
                  data-action="click->theme-selector#toggle">
            <!-- live theme swatch -->
            <span aria-hidden="true" class="block w-4 h-4 rounded-full border border-gray-300 dark:border-gray-600" style="background-color: var(--swatch-color);"></span>
          </button>
          <!-- Backdrop -->
          <div class="fixed inset-0 hidden" data-theme-selector-target="backdrop" data-action="click->theme-selector#close"></div>
          <!-- Panel -->
          <div class="absolute left-0 mt-2 z-30 w-64 rounded-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-navy shadow-lg p-4 hidden" data-theme-selector-target="panel" role="menu" aria-label="<%= t('theme.choose_accent') %>">
            <%# Row 1: Professional themes %>
            <div class="grid grid-cols-8 gap-4 mb-4 justify-items-center">
              <% themes_for_row(1).each do |theme_key, theme_data| %>
                <button type="button"
                        class="<%= theme_button_classes(theme_key) %>"
                        <% if (style = theme_button_style(theme_key)) %>style="<%= style %>"<% end %>
                        aria-label="<%= t("theme.#{theme_key}") %>"
                        title="<%= t("theme.#{theme_key}") %>"
                        data-action="click->theme-selector#select"
                        data-theme-selector-target="button"
                        data-theme-selector-theme-param="<%= theme_key %>"></button>
              <% end %>
            </div>
            <%# Row 2: Vibrant/Fun themes %>
            <div class="grid grid-cols-8 gap-4 justify-items-center">
              <% themes_for_row(2).each do |theme_key, theme_data| %>
                <button type="button"
                        class="<%= theme_button_classes(theme_key) %>"
                        <% if (style = theme_button_style(theme_key)) %>style="<%= style %>"<% end %>
                        aria-label="<%= t("theme.#{theme_key}") %>"
                        title="<%= t("theme.#{theme_key}") %>"
                        data-action="click->theme-selector#select"
                        data-theme-selector-target="button"
                        data-theme-selector-theme-param="<%= theme_key %>"></button>
              <% end %>
            </div>
          </div>
        </div>
        <span class="text-gray-300 dark:text-navy">|</span>
        <%= link_to rechtspraak_path, class: %w[text-gray-600 dark:text-mist hover:text-[var(--accent-600)] dark:hover:text-[var(--accent-500)] transition-colors duration-150 ease-out motion-reduce:transition-none].join(" "), title: t('jurisprudence.title', default: 'Rechtspraak') do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" />
          </svg>
        <% end %>
        <span class="text-gray-300 dark:text-navy">|</span>
        <%= link_to bookmarks_path, class: %w[text-gray-600 dark:text-mist hover:text-[var(--accent-600)] dark:hover:text-[var(--accent-500)] transition-colors duration-150 ease-out motion-reduce:transition-none].join(" "), title: t('bookmarks.title') do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z" />
          </svg>
        <% end %>
        <span class="text-gray-300 dark:text-navy">|</span>
        <%= link_to tools_path, class: %w[text-gray-600 dark:text-mist hover:text-[var(--accent-600)] dark:hover:text-[var(--accent-500)] transition-colors duration-150 ease-out motion-reduce:transition-none].join(" "), title: t('tools.title', default: I18n.locale == :fr ? 'Outils juridiques' : 'Juridische tools') do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
          </svg>
        <% end %>
        <%# RSS feed dropdown %>
        <div class="relative" data-controller="dropdown">
          <button type="button"
                  class="text-gray-600 dark:text-mist hover:text-orange-500 dark:hover:text-orange-400 transition-colors duration-150 ease-out motion-reduce:transition-none"
                  data-action="click->dropdown#toggle"
                  data-dropdown-target="button"
                  title="<%= t('rss.subscribe') %>">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor">
              <path d="M5 3a1 1 0 000 2c5.523 0 10 4.477 10 10a1 1 0 102 0C17 8.373 11.627 3 5 3z"/>
              <path d="M4 9a1 1 0 011-1 7 7 0 017 7 1 1 0 11-2 0 5 5 0 00-5-5 1 1 0 01-1-1z"/>
              <circle cx="5" cy="15" r="2"/>
            </svg>
          </button>
          <div class="hidden absolute left-0 mt-2 w-48 bg-white dark:bg-navy rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-50"
               data-dropdown-target="menu">
            <div class="py-1">
              <p class="px-3 py-1 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase"><%= t('rss.feeds') %></p>
              <%= link_to laws_path(format: :rss), class: "block px-3 py-2 text-sm text-gray-700 dark:text-mist hover:bg-gray-100 dark:hover:bg-sky/10", target: "_blank" do %>
                <%= t('rss.all_laws') %>
              <% end %>
              <hr class="my-1 border-gray-200 dark:border-sky/20">
              <%= link_to laws_path(format: :rss, law: 1), class: "block px-3 py-2 text-sm text-gray-700 dark:text-mist hover:bg-gray-100 dark:hover:bg-sky/10", target: "_blank" do %>
                <%= t(:law) %>
              <% end %>
              <%= link_to laws_path(format: :rss, decree: 1), class: "block px-3 py-2 text-sm text-gray-700 dark:text-mist hover:bg-gray-100 dark:hover:bg-sky/10", target: "_blank" do %>
                <%= t(:decree) %>
              <% end %>
              <%= link_to laws_path(format: :rss, decision: 1), class: "block px-3 py-2 text-sm text-gray-700 dark:text-mist hover:bg-gray-100 dark:hover:bg-sky/10", target: "_blank" do %>
                <%= t(:decision) %>
              <% end %>
              <%= link_to laws_path(format: :rss, ordinance: 1), class: "block px-3 py-2 text-sm text-gray-700 dark:text-mist hover:bg-gray-100 dark:hover:bg-sky/10", target: "_blank" do %>
                <%= t(:ordinance) %>
              <% end %>
            </div>
          </div>
        </div>
        <span class="text-gray-300 dark:text-navy">|</span>
        <%= link_to "NL (wetwijzer.be)", "http://wetwijzer.be", class: %w[font-medium text-gray-600 dark:text-mist hover:text-[var(--accent-600)] dark:hover:text-[var(--accent-500)] hover:underline transition-colors duration-150 ease-out motion-reduce:transition-none].join(" ") %>
        <span class="text-gray-300 dark:text-navy">|</span>
        <%= link_to "FR (lisloi.be)", "http://lisloi.be", class: %w[font-medium text-gray-600 dark:text-mist hover:text-[var(--accent-600)] dark:hover:text-[var(--accent-500)] hover:underline transition-colors duration-150 ease-out motion-reduce:transition-none].join(" ") %>
      </div>
      
      <!-- Profile / Login -->
      <div class="flex items-center">
        <% if logged_in? %>
          <div class="relative" data-controller="dropdown">
            <button type="button" 
                    class="flex items-center justify-center w-8 h-8 rounded-full bg-blue-600 text-white font-semibold text-sm hover:bg-blue-700 transition-colors"
                    data-dropdown-target="button"
                    data-action="click->dropdown#toggle"
                    title="<%= current_user.name || current_user.email %>">
              <%= (current_user.name&.first || current_user.email.first).upcase %>
            </button>
            <div class="absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5 hidden z-50" data-dropdown-target="menu">
              <div class="py-1">
                <div class="px-4 py-2 text-sm text-gray-500 dark:text-gray-400 border-b border-gray-200 dark:border-gray-700">
                  <%= current_user.email %>
                </div>
                <%= link_to account_path, class: "block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700" do %>
                  <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                  <%= t('account.title', default: 'Account') %>
                <% end %>
                <%= link_to credits_path, class: "block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700" do %>
                  <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                  <%= t('credits.title', default: 'Credits') %> (<%= current_user.credits %>)
                <% end %>
                <%= link_to subscription_path, class: "block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700" do %>
                  <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
                  <%= t('subscriptions.title', default: 'Subscription') %>
                <% end %>
                <%= button_to logout_path, method: :delete, class: "w-full text-left px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700" do %>
                  <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
                  <%= t('auth.logout', default: 'Logout') %>
                <% end %>
              </div>
            </div>
          </div>
        <% else %>
          <%= link_to login_path, class: "px-3 py-1.5 text-sm font-medium text-gray-600 dark:text-mist hover:text-[var(--accent-600)] dark:hover:text-[var(--accent-500)] transition-colors" do %>
            <%= t('auth.login', default: 'Login') %>
          <% end %>
          <%= link_to signup_path, class: "ml-2 px-3 py-1.5 text-sm font-medium bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors" do %>
            <%= t('auth.signup', default: 'Sign up') %>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
</header>
